
```{r admin, message = FALSE, warning = FALSE, results = "hide"}
# ----- admin -----
rm(list = ls())  # clear environment
library(rmarkdown)  # markdown
library(knitr)  # knitr
library(tidyverse)  # for tidy data import and wrangling
library(factoextra)  # for cluster visualization
library(fpc)  # for dbscan clustering
library(caret)  # for dummy variables
library(cluster)  # for clustering
library(GGally)  # for matrix plotting
library(RColorBrewer)  # for color palettes
gc()  # garbage collection
set.seed(888)  # set seed for random number generation reproducibility
```


## Data Import, Transforming and Wrangling
To get the data set into a tidy data frame for modeling, I had to import, 
explore to get an understanding, transform and wrangle the data. Specific to
transformation, I leveraged the dummyVars() function in the caret package to 
quickly perform one-hot encoding of all dummy variables.

Note that 6 species did not appear in the GamePress data, and these were 
suppressed from analysis. They were Caterpie, Metapod, Weedle, Kakuna, Magikarp
and Ditto. Note that this suppression was minimal in impact as these species 
were considered very insignificant in terms of playing capabilities.


```{r acquire_data, message = FALSE, warning = FALSE, results = "hide"}
# ----- import base data - kaggle's PG data set -----
pg01 <- as_tibble(read_csv("pokemonGO.csv", 
        col_names = TRUE)) %>%
    dplyr::select(-`Image URL`) %>%
    rename(pm_nbr = `Pokemon No.`, typ1 = `Type 1`, typ2 = `Type 2`, 
        max_cp = `Max CP`, max_hp = `Max HP`, name = Name) %>%
    arrange(pm_nbr)
glimpse(pg01)  # not all pokemon have secondary type
summary(pg01)  # no missing values except for secondary type

# ----- import base data - Game Press' IV spreadsheet -----
pg02 <- as_tibble(read_csv(
        "TDO SHEET BY DPS - Sheet1.csv", 
        col_names = TRUE)) %>%
    mutate(pm_nbr = ifelse(dex >= 100, as.character(dex),
        ifelse(dex >= 10, str_c("0", as.character(dex)),
            str_c("00", as.character(dex))))) %>%
    select(pm_nbr, pokemon, WeaveDPS, TDO, `~TDO per CP`, `~SurvivalTime`) %>%
    rename(weave_dps = WeaveDPS, tdo = TDO, tdo_cp = `~TDO per CP`, 
        surv_time = `~SurvivalTime`) %>%
    arrange(pm_nbr, desc(tdo)) %>%
    group_by(pm_nbr) %>%
    filter(tdo == max(tdo)) %>%
    filter(weave_dps == max(weave_dps)) %>%
    ungroup() %>%
    distinct(pm_nbr, pokemon, weave_dps, tdo, tdo_cp, surv_time)
glimpse(pg02)
summary(pg02)

# ----- transform by encoding dummy variables -----
dmy <- dummyVars("~ typ1 + typ2", data = pg01)
pg03 <- as_tibble(predict(dmy, newdata = pg01)) %>%
    replace(., is.na(.), 0) %>%
    mutate(
        typ_bug = as.factor(typ1Bug),
        typ_dragon = as.factor(typ1Dragon),
        typ_electric = as.factor(typ1Electric),
        typ_fairy = as.factor(pmax(typ1Fairy, typ2Fairy)),
        typ_fighting = as.factor(pmax(typ1Fighting, typ2Fighting)),
        typ_fire = as.factor(typ1Fire),
        typ_ghost = as.factor(typ1Ghost),
        typ_grass = as.factor(pmax(typ1Grass, typ2Grass)),
        typ_ground = as.factor(pmax(typ1Ground, typ2Ground)),
        typ_ice = as.factor(pmax(typ1Ice, typ2Ice)),
        typ_normal = as.factor(typ1Normal),
        typ_poison = as.factor(pmax(typ1Poison, typ2Poison)),
        typ_psychic = as.factor(pmax(typ1Psychic, typ2Psychic)),
        typ_rock = as.factor(pmax(typ1Rock, typ2Rock)),
        typ_water = as.factor(pmax(typ1Water, typ2Water)),
        typ_flying = as.factor(typ2Flying),
        typ_steel = as.factor(typ2Steel)) %>%
    bind_cols(pg01) %>%
    select(max_cp, max_hp, starts_with("typ_"))
summary(pg03)
glimpse(pg03)

# ----- wrangle to combine data sets -----
pg04 <- pg01 %>%
    left_join(pg02, by = "pm_nbr") %>%
    select(pm_nbr, name, typ1, typ2, weave_dps, tdo, tdo_cp, surv_time) %>%
    bind_cols(pg03) %>%
    filter(weave_dps >= 0)  # few small species missing
```